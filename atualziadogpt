function analisarEInserirLinha() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var range = sheet.getDataRange();
  var values = range.getValues();

  var colunaIniciar = -1;
  var linhaInicial = 2; // Começa duas linhas abaixo da linha "INICIAR"
  var linhaAtual = linhaInicial;
  var numLinhas = values.length;

  // Marcar o início do tempo
  var tempoInicio = new Date().getTime();

  // Encontrar a coluna que contém a palavra "INICIAR" na linha 1
  for (var i = 0; i < values[0].length; i++) {
    if (values[0][i] === 'INICIAR') {
      colunaIniciar = i;
      break;
    }
  }
  
  if (colunaIniciar === -1) {
    Browser.msgBox('Palavra "INICIAR" não encontrada na linha 1.');
    return;
  }

  while (linhaAtual < numLinhas) {
    values = sheet.getDataRange().getValues();
    
    if (values[linhaAtual][colunaIniciar] === 'PARAR') {
      break; // Parar se encontrar "PARAR"
    }

    var valorReferencia = values[linhaAtual][colunaIniciar];
    var colunaAtual = colunaIniciar + 1;

    // Dicionário para armazenar as diferenças
    var diferencas = [];

    while (colunaAtual < values[linhaAtual].length) {
      var valorAtual = values[linhaAtual][colunaAtual];
      
      if (valorAtual === '') {
        // Parar se encontrar a primeira célula vazia
        break;
      }

      if (valorAtual !== valorReferencia) {
        // Calcular a diferença
        var diferenca = valorAtual - valorReferencia;
        // Armazenar a diferença com a coluna correspondente
        diferencas.push({ coluna: colunaAtual + 1, diferenca: diferenca });
      }
      
      colunaAtual++; // Mover para a próxima coluna
    }

    if (diferencas.length > 0) {
      // Inserir nova linha abaixo
      sheet.insertRowAfter(linhaAtual + 1);
      var novaLinha = linhaAtual + 2;

      // Obter o valor da célula na primeira coluna da linha original
      var valorPrimeiraColuna = values[linhaAtual][0];

      // Adicionar o sufixo _1 ao valor da primeira coluna
      var valorNovaLinha = valorPrimeiraColuna + '_1';
      
      // Preencher a nova linha com as diferenças
      sheet.getRange(novaLinha, 1).setValue(valorNovaLinha);
      diferencas.forEach(function(diferenca) {
        sheet.getRange(novaLinha, diferenca.coluna).setValue(diferenca.diferenca);
      });

      // Copiar valores das colunas 2 até a 112 da linha atual para a nova linha
      for (var col = 1; col <= 112; col++) {
        var valor = values[linhaAtual][col];
        sheet.getRange(novaLinha, col + 1).setValue(valor);
      }

      // Preencher células vazias com 0 até a célula anterior ao último número diferente
      var ultimaColunaDiferenca = diferencas[diferencas.length - 1].coluna; // Última coluna preenchida
      for (var i = 1; i < ultimaColunaDiferenca; i++) {
        if (sheet.getRange(novaLinha, i + 1).getValue() === '') {
          sheet.getRange(novaLinha, i + 1).setValue(0);
        }
      }

      // Atualizar o número de linhas após a inserção
      numLinhas = sheet.getDataRange().getValues().length;
      
      // Atualizar a linha atual e os valores
      linhaAtual++;
      values = sheet.getDataRange().getValues(); // Atualizar valores após inserção
    }

    linhaAtual++; // Avançar para a próxima linha
  }

  // Marcar o fim do tempo
  var tempoFim = new Date().getTime();
  var tempoExecucao = (tempoFim - tempoInicio) / 1000; // Tempo em segundos
  var minutos = Math.floor(tempoExecucao / 60);
  var segundos = (tempoExecucao % 60).toFixed(2);

   var htmlOutput = HtmlService.createHtmlOutput(
    '<html>' +
    '<head><base target="_top">' +
    '<style>' +
    'body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }' +
    '.container { display: flex; flex-direction: column; align-items: center; justify-content: center; }' +
    '.image { width: 100px; margin-bottom: 10px; }' +
    '.message { font-size: 16px; margin-bottom: 10px; }' +
    '.time { font-size: 14px; color: #555; margin-bottom: 20px; }' +
    '.button { background-color: #a9a9a9; color: black; border: none; padding: 15px 32px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer; border-radius: 5px; }' +
    '</style>' +
    '</head>' +
    '<body>' +
    '<div class="container">' +
    '<img class="image" src="https://i.imgur.com/1N7brwP.png" alt="Certinho">' + // URL da sua imagem
    '<div class="message">Fluxo anual e mensal segregado com sucesso!</div>' +
    '<div class="time">Tempo de execução: ' + minutos + ' minuto(s) e ' + segundos + ' segundo(s)</div>' +
    '<button class="button" onclick="google.script.host.close()">Estou ciente!</button>' +
    '</div>' +
    '</body>' +
    '</html>'
  ).setWidth(400).setHeight(250);

  SpreadsheetApp.getUi().showSidebar(htmlOutput);
}
